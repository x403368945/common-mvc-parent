<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Markdown</title>
</head>
<body>
<h1>Markdown</h1>
<script>
    (async function () {
        // TODO 采坑记录，如果是跨域请求，每次 JSESSIONID 都在变，需要配置 {credentials: 'include'}
        await fetch(`http://${location.host}/login`, {
            method: 'POST',
            credentials: 'include',
            headers: {'Content-Type': 'application/json;charset=utf-8'},
            body: JSON.stringify({json: {username: 'admin', password: 'admin'}})
        }).then((res) => res.json()).then(json => console.log(json));

        const http = {
            POST: (url) => {
                return fetch(`http://${location.host}${url}`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json;charset=utf-8'},
                    body: JSON.stringify({json: {}})
                }).then((res) => res.json()).then(json => console.log(json))
            },
            PUT: (url) => {
                return fetch(`http://${location.host}${url}`, {
                    method: 'PUT',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json;charset=utf-8'},
                    body: JSON.stringify({json: {}})
                }).then((res) => res.json()).then(json => console.log(json))
            },
            PATCH: (url) => {
                return fetch(`http://${location.host}${url}`, {
                    method: 'PATCH',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json;charset=utf-8'},
                    body: JSON.stringify({json: {}})
                }).then((res) => res.json()).then(json => console.log(json))
            },
            DELETE: (url) => {
                return fetch(`http://${location.host}${url}`, {
                    method: 'DELETE',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json;charset=utf-8'}
                }).then((res) => res.json()).then(json => console.log(json))
            },
            GET: (url) => {
                return fetch(`http://${location.host}${url}`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json;charset=utf-8'}
                }).then((res) => res.json()).then(json => console.log(json))
            }
        };

        const arrs = `
	c.d.b.c.w.AdminConfigController:
	{GET /admin-config/{version}/path}: getPath(TabUser,int)
	{GET /admin-config/{version}/url}: getUrl(TabUser,int)
	{GET /admin-config/{version}/{key}}: getByKey(int,String)
	{GET /admin-config/{version}/app}: getApp(TabUser,int)
23:12:23.321 TRACE [       restartedMain]         o.s.w.s.m.m.a.RequestMappingHandlerMapping [] :
	c.d.b.c.w.FileController:
	{POST /file/{version}/uploads}: uploadFiles(int,MultipartFile[])
	{POST /file/{version}/upload}: uploadFile(int,MultipartFile)
23:12:23.323 TRACE [       restartedMain]         o.s.w.s.m.m.a.RequestMappingHandlerMapping [] :
	c.d.b.c.w.HomeController:
	{[GET, POST, PUT, PATCH, DELETE] /}: home()
	{[GET, POST, PUT, PATCH, DELETE] /error}: error()
23:12:23.325 TRACE [       restartedMain]         o.s.w.s.m.m.a.RequestMappingHandlerMapping [] :
	c.d.b.u.w.UserController:
	{GET /user/{version}/current}: current(TabUser,int)
	{PATCH /user/{version}/nickname}: updateNickname(TabUser,int,Param)
23:12:23.327 TRACE [       restartedMain]         o.s.w.s.m.m.a.RequestMappingHandlerMapping [] :
	c.d.o.a.w.OpenAuthController:
	{POST /open/auth/{version}/login}: login(int,Param,HttpServletRequest,HttpServletResponse)
	{POST /open/auth/{version}/login/SESSION}: loginBySession(int,Param,HttpServletRequest)
23:12:23.334 TRACE [       restartedMain]         o.s.w.s.m.m.a.RequestMappingHandlerMapping [] :
	c.d.o.c.w.OpenCodeController:
	{GET /open/code/{version}/check/{code}}: checkImageCode(int,String,HttpServletRequest)
	{GET /open/code/{version}}: getImageCode(int,HttpServletRequest)
23:12:23.353 TRACE [       restartedMain]         o.s.w.s.m.m.a.RequestMappingHandlerMapping [] :
	c.d.o.c.w.OpenTestController:
	{PUT /open/test/{version}/{id}}: update(int,String,Param)
	{POST /open/test/{version}}: save(int,Param)
	{GET /open/test/{version}}: search(int,String)
	{GET /open/test/{version}/application/xml, produces [application/xml]}: getApplicationXml()
	{DELETE /open/test/{version}/{id}}: deleteById(int,String)
	{GET /open/test/{version}/{id}}: findById(int,String)
	{GET /open/test/{version}/{number}/{size}}: page(int,int,int,String)
	{PATCH /open/test/{version}/{id}}: markDeleteById(int,String)
	{PATCH /open/test/{version}}: markDelete(int,Param)
	{GET /open/test/{version}/codes}: codes(int)
	{GET /open/test/{version}/text/xml, produces [text/xml]}: getTextXml()
	{GET /open/test/{version}/thymeleaf}: thymeleaf(ModelMap)
	{PATCH /open/test/{version}/change/{id}}: updateById(int,String,Param)
`.trim().split(/\n/)
            .map(v => v.trim().replace(/^({.*}).*$/, '$1'))
            .filter(v => v.startsWith('{'))
            .map(v => v.slice(1).slice(0, -1)
                .replace(/(\[(\w+).*])/, '$2')
                .split(' '))
            .map(([method, url]) => Object.assign({
                method,
                url: url
                    .replace(/{(version|id|uid|number|size|timestamp)}/g, 1)
                    .replace(/{\w}/g, 1)
            }))
            // .map(v => {
            //     console.log(v);
            //     return v
            // })
        ;
        for (let i = 0; i < arrs.length; i++) {
            const {method, url} = arrs[i];
            console.log([method, url]);
            if (url.match(/^\/open\/test/) || '/' === url) {
                console.log(`忽略接口：${url}`);
            } else if (
                [
                    // '/file/1/upload',
                    // '/file/1/uploads',
                    ''
                ].includes(url)) {
                console.warn(`暂时排除该接口：${url}`);
            } else {
                await http[method](url)
            }
        }
    })();
</script>
</body>
</html>